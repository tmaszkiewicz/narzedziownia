<!DOCTYPE html>
{% extends 'narzedziownia/base.html' %}
{% load jsignature_filters %}
{% load staticfiles %}
{% block css%}
<style>

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
</style>
{% endblock css%}
{% block body %}
<script>
var dz = [];
var wa = [];
</script>
{%for i in dzialy%}
<script>
dz.push("{{i.dzial}}");
</script>
{%endfor%}
{%for i in warianty%}
<script>
wa.push({
    wariant: "{{i.wariant}}",
    dzial: "{{i.dzial}}"
});
</script>
{%endfor%}

<div class="container" align="center">
	<div class="row">
		<div class="col-10">
			<form name="wypozycz" method="POST" enctype="multipart/form-data" action="">	
				<br><br>
				{% csrf_token %}
				{{form.narzedzie}}
				{{form.opis}}
				{{form.ilosc}}
				<input type="date" id="data_pobrania" onLoad="getDate()" name="data_pobrania" value= {{form.data_pobrannia}}/>

				<!--
				<input type="date" id="data_oddania" name="data_oddania" value={{form.data_oddania}}></input>-->


				<input type="submit" value="DODAJ"></input>
			</form>
		<br><br>


                                <label class="control-label">Narzędzia dla Dzialu:</label>
                                <select onChange="initWariant()" id="dzial"  name="Dzial">
                                <option value={{Prac.dzial}} selected disabled hidden>{{Prac.dzial}}</option>
                                   {%for i in dzialy%}
                                    <option value="{{i.dzial}}">{{i.dzial}}</option>
                                   {%endfor%}
                                </select>
                                <label class="control-label">Wariant:</label>

                                <select id="wariant"  name="Wariant">
                                <option value={{dzial}} selected disabled hidden>{{dzial}}</option>
                                </select>
                                <button onClick="goAddr('dzial','wariant',{{Prac.pk}})">GENERUJ</button>






		
		</div>
		<div class="col-2">
			<br><br>
			<button onClick="goAddrBar({{Prac.pk}})">TRYB BARCODE</button>
			
		</div>
	</div>
	<div class="row">
		<br><br><br>
	</div>
	<div class="row">
		<div class="col-4">
			<a>PRACOWNIK</a>
			<br><br>

			<img src="{% static 'odziez/photos/' %}{{Prac.nr_pracownika}}.bmp" style="width:150px;" align="center">
			<br>
			{{Prac.nr_pracownika}}
			<br>
			{{Prac.nazwisko_imie}}
			<br>
			<a href={% url 'narzedziownia:potwierdz' Prac.pk %}>WYSWIETL</a>
			<br>
			<button id="myBtn">Odzież</button>
			
		</div>
		<div class="col-8">
			<table id="tabel" class="table table-sm">
			<tr>
			<th>
			NARZĘDZIE/OPIS
			
			</th>
			<th>
			ILOŚĆ
			
			</th>
			<th>
			POBRANIE
			
			</th>
			<th>
			ODDANO
			
			</th>
			<!--
			<th>
			ZWROT
			</th>-->
			<th>
			USUN
			</th>
			<th>
			DOPASUJ
			</th>
			<th>
			PODPIS
			</th>
			</tr>
			<form name="checkboxy" method="GET" enctype="multipart/form-data" action="">
t
			{%for i in Pobr_filter%}
			{%if i.signature == None and i.signature_handy == None %}
			<tr style="color:#FF0000">
			{% else %}
			<tr >
			{% endif %}
			<td>
			{{i.narzedzie}} / <input type="text" size="10" name="opis{{i.pk}}" id="opis{{i.pk}}" value="{{i.opis|default:""}}">
			</td>
			<td>
			{{i.ilosc}}
			</td>
			<td>
			<input type="date" name="data{{i.pk}}" id="data{{i.pk}}" value="{{i.data_pobrania|date:"Y-m-d"}}">
			</td>
			
			<td style="text-align:center;">
			
			{%if i.oddano%}
			<input type="checkbox" checked name="oddano{{i.pk}}" id="oddano{{i.pk}}"></input>
			{%else%}
			<input type="checkbox"  name="oddano{{i.pk}}" id="oddano{{i.pk}}"></input>
			{%endif%}

			</td>
		

			<td style="text-align:center;">
			<a href='http://jan-svr-intra01:8000/narzedziownia/pracownicy_usun_pobranie/{{Prac.pk}}/{{i.pk}}/'>X</a>
			</td>
			<td style="text-align:center; background-color:#ffebe6;">
				<input type="checkbox" checked name={{i.pk}} id={{i.pk}}></input>
			</td>
			<td>
				{%if i.signature != None %}
				KARTA
					
				{% elif i.signature_handy != None%}
			
					
					<img src="{{ i.signature_handy|signature_base64 }}" alt="{{ i }}" width="100px"/>
				{%else%}
				BRAK
				{% endif %}
			</td>
			</tr>
			{%endfor%}
			<tr>
			<td >
			</td>
			<td>
			<input type="submit" value="Popraw"></input>	
			</td>
			<td>
			</tr>
			</form>
			
			</table>
		</div>
	</div>
	<div class = "row">
		
		<div class="col-8">
		</div>
		<div class="col-4">
		
		<p align="left">	
		<table class="table-sm table-info table-striped">
		<tr>

		<th>
	
		POBRANA ODZIEŻ

		</th>
		<th>	
		IL.
		</th>
		<th>
		DATA POBR.
		</th>
		<th>
	
		PODPIS

		</th>
		</tr>
		{% for o in PobranieOdziez %}
		{%if not o.oddano %}
		<tr>
		<td>
		{{o.odziez}}
		</td><td>
		{{o.ilosc}}
		</td><td>
		{{o.data_pobrania|date:"Y-m-d"}}
		</td>
		<td>

			{%if o.signature != None %}
			KARTA
				
			{% elif o.signature_handy != None%}
		
				
				<img src="{{ o.signature_handy|signature_base64 }}" alt="{{ i }}" width="100px"/>
			{%else%}
			BRAK
			{% endif %}
		</td>


		<br>
		
		
		
		</tr>
		{%endif%}
		{%endfor%}
		</table>
		</p>
		</div>
	</div>
	<div class="row">
		<div class="col-12" align="right">

			<button type="button" class="btn btn-danger btn-sm" id="myBtnAlert">Archiwizuj</button>
		</div>
	</div>
</div>

<!-- Trigger/Open The Modal -->
<!--<button id="myBtn">Odzież</button>-->

<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content modal-lg">
    <span class="close">&times;</span>
	<form method="POST" action="">
	{% csrf_token %}
	<center>
	<table class="table-sm">
	<thead class="thead-dark">
		<tr style="background-color:grey;">
			<th style="background-color:grey;">
				ODZIEŻ
			</th>
			<th>
				ILOŚĆ
			</th>
			<th>
				DATA_POBR
			</th>
			<th>
				ODDANA
			</th>
			<th>
				PRZYPISANA
			</th>
		<tr>
	</thead>
	{%for odz in Odziez%}
	<div class="row">
	<tr>	
		<div class="col-5">
		<td>
		    {{odz.nazwa}}
		</td>
		</div>
		<div class="col-5">
		<td>
		{%if odz.checked  %}
		 <input type="number" size="2" min="0" max="99"  id="n{{odz.odziez_id}}" name="n{{odz.odziez_id}}"  value={{odz.ilosc}}>
		{% else %}

		 <input  style="display:none;" type="number" size="2" min="0" max="99" id="n{{odz.odziez_id}}" name="n{{odz.odziez_id}}" value={{odz.ilosc}}>
		{% endif %}
	
		
		</td>
		<td>

		{%if odz.checked %}
		 <input type="date" id="d{{odz.odziez_id}}" name="d{{odz.odziez_id}}" value={{odz.data_pobrania|date:"Y-m-d"}}>
		{% else %}

		 <input style="display:none;" type="date" id="d{{odz.odziez_id}}" name="d{{odz.odziez_id}}" value={{odz.data_pobrania|date:"Y-m-d"}}>
		{% endif %}
	
		
		</td>
		<td style="text-align:center;">

		{% if odz.checked and odz.oddano%}
		
	
			<input type="checkbox" id="o{{odz.odziez_id}}" name="o{{odz.odziez_id}}" checked>

		{% elif odz.checked and not odz.oddano%}

			<input type="checkbox" id="o{{odz.odziez_id}}" name="o{{odz.odziez_id}}">
		

		{% elif not odz.checked and odz.oddano%}

		<input style="display:none;" type="checkbox" id="o{{odz.odziez_id}}" name="o{{odz.odziez_id}}" checked>

		{% elif not odz.checked and not odz.oddano%}

		<input style="display:none;" type="checkbox" id="o{{odz.odziez_id}}" name="o{{odz.odziez_id}}">

		{% endif %}
	
		
		</td>
		</div>
		<div class="col-2">
		<td  style="text-align:center; background-color:#ffebe6;">
		{%if odz.checked  %}
		   <input type="checkbox" checked name={{odz.odziez_id}} id={{odz.odziez_id}} onChange=dateHandler("d{{odz.odziez_id}}","{{odz.odziez_id}}","n{{odz.odziez_id}}","o{{odz.odziez_id}}")>
		{%else%}
		   <input type="checkbox" name={{odz.odziez_id}} id={{odz.odziez_id}} onChange=dateHandler("d{{odz.odziez_id}}","{{odz.odziez_id}}","n{{odz.odziez_id}}","o{{odz.odziez_id}}") onLoad="getDate();">
		{%endif%}
		</td>
		</div>
	<tr>
	</div>
	{%endfor%}
	</table>
	<input type="submit" value="OK">
	</form>

  </div>

</div>
<div id=myModalAlert class="modal">

  <div class="modal-content modal-sm">
    <span class="closeAlert">&times;</span>
    	<button type="button" class="btn btn-danger btn-sm" onClick="goAddrArch({{Prac.pk}})">ARCHIWIZUJ PRACOWNIKA: {{Prac.nazwisko_imie}}</button>
	
  </div>
</div>


<script type="text/javascript">
// Get the modal
var modal = document.getElementById("myModal");
var modalAlert = document.getElementById("myModalAlert");
// Get the button that opens the modal
var btn = document.getElementById("myBtn");
var btnAlert = document.getElementById("myBtnAlert");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
var spanAlert = document.getElementsByClassName("closeAlert")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
}

btnAlert.onclick = function() {
try {
  modalAlert.style.display = "block";
} catch(error) {alert(error);}
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}
spanAlert.onclick = function() {
  modalAlert.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";

  }
  if (event.target == modalAlert) {
    modalAlert.style.display = "none";
  }
}

//MODAL SECTION ENDS
        try{
    var today = new Date();
document.getElementById("data_pobrania").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
                d = document.getElementById("dzial");

        } catch(error){
                alert(error);
        }
        var sel_war=document.getElementById("wariant");
        while(sel_war.options.length > 0) {
        sel_war.remove(0);
        }
        for(i in wa){
                if(wa[i].dzial==d.value){
                        var option = document.createElement("option");
                        option.text=wa[i].wariant;
                        sel_war.add(option);
                }
        }

function hide(id) {
if( document.getElementById(id).style.visibility == "visible")
{
document.getElementById(id).style.visibility = "hidden";
}
else
{	
document.getElementById(id).style.visibility = "visible";
document.getElementById(id).type = "text";

}
}
function fill() {

alert("Hello! I am an alert box!!");
}

function initWariant() {
        //document.write(wa,dz);
        try{
                d = document.getElementById("dzial");

        } catch(error){
                alert(error);
        }
        var sel_war=document.getElementById("wariant");
        while(sel_war.options.length > 0) {
        sel_war.remove(0);
        }
        for(i in wa){
                if(wa[i].dzial==d.value){
                        //document.write(wa[i].dzial,d.value);
                        //document.write(wa[i].wariant);
                        var option = document.createElement("option");
                        option.text=wa[i].wariant;
                        sel_war.add(option);
                }
        }
}

function goAddr(dzial,war,prac) {

dzial = document.getElementById(dzial);
war = document.getElementById(war);


url="http://jan-svr-intra01:8000/narzedziownia/pracownicy_szablon/"+dzial.value+"/"+war.value+"/"+prac+"/";
 window.location.href = url;

}
function goAddrBar(prac) {


url="http://jan-svr-intra01:8000/narzedziownia/pracownicy_edit_barcode/"+prac+"/";
window.location.href = url;

}
function goAddrArch(prac) {

url="http://jan-svr-intra01:8000/narzedziownia/pracownicy_arch/"+prac+"/";
window.location.href = url;

}
function dateHandler(id,id2,id3,id4) {
try {
	var datepicker = document.getElementById(id);
	var checker = document.getElementById(id2);
	var ilosc = document.getElementById(id3);
	var oddano = document.getElementById(id4);
	if(checker.checked)
	{
	ilosc.style.display="inline"
	oddano.style.display="inline"
	//var dateFormat = require('dateformat');
	var today = new Date();



	datepicker.style.display="inline";
	if(datepicker.value == "" ){
	datepicker.value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
	}
	}
	else{
	datepicker.style.display="none";
	ilosc.style.display="none"
	oddano.style.display="none"
	}

 } catch(error){
alert("error");
}

}


</script>
{% endblock body %}
